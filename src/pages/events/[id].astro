---
import { fallbackEvents } from '../../data/fallbackEvents.js';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  let events = [];
  try {
    const response = await fetch('https://raw.githubusercontent.com/EthCzech/czechcryptoweek/main/events/index.json');
    events = await response.json();
  } catch (error) {
    console.error('Error fetching events for static paths:', error);
    events = fallbackEvents;
  }
  
  // Only generate pages for confirmed events
  const confirmedEvents = events.filter(event => event.confirmed !== false);
  return confirmedEvents.map(event => ({ params: { id: event.id } }));
}

const { id } = Astro.params;
let event;

// Try to fetch data, fall back to hardcoded data if fetch fails
try {
  const response = await fetch(`https://raw.githubusercontent.com/EthCzech/czechcryptoweek/main/events/${id}/info.json`);
  event = await response.json();
} catch (error) {
  console.error(`Error fetching data for event ${id}:`, error);
  // Find the matching event in our fallback data
  event = fallbackEvents.find(e => e.id === id);
}

// If no event is found, provide a basic fallback
if (!event) {
  event = {
    name: "Event Not Found",
    date: "N/A",
    location: "N/A",
    description: "We couldn't find information for this event.",
    organizers: ["Unknown"],
    website: "/"
  };
}
---

<BaseLayout title={`${event.name} | Czech Crypto Week`} description={event.short_description || event.description}>
  <div class="event-detail">
    <a href="/" class="back-link">‚Üê Back to all events</a>
    
    <div class="event-header">
      <h1>{event.name}</h1>
      <div class="event-meta">
        <div class="event-meta-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
          <span>{event.date}</span>
        </div>
        <div class="event-meta-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
          <span>{event.location}</span>
        </div>
        <div class="event-meta-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
          <span>{event.organizers.join(', ')}</span>
        </div>
      </div>
    </div>
    
    <div class="event-content">
      <div class="event-description">
        <h2>About This Event</h2>
        <p>{event.description}</p>
        
        <a href={event.website} target="_blank" rel="noopener noreferrer" class="website-button">
          Visit Official Website
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
        </a>
      </div>
      
      <div class="event-sidebar">
        {event.venue && (
          <div class="sidebar-section">
            <h3>Venue Information</h3>
            <p class="venue-name">{event.venue.name}</p>
            <p class="venue-address">{event.venue.address}</p>
          </div>
        )}
        
        {event.prizes && (
          <div class="sidebar-section">
            <h3>Prizes</h3>
            <p>{event.prizes}</p>
          </div>
        )}
        
        {event.sponsors && (
          <div class="sidebar-section">
            <h3>Sponsors</h3>
            <p>{typeof event.sponsors === 'string' ? event.sponsors : event.sponsors.join(', ')}</p>
          </div>
        )}
      </div>
    </div>
  </div>
  
  <style>
    .event-detail {
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .back-link {
      display: inline-block;
      margin-bottom: 30px;
      color: var(--text-light);
      text-decoration: none;
      transition: color 0.2s;
    }
    
    .back-link:hover {
      color: var(--primary);
    }
    
    .event-header {
      margin-bottom: 40px;
    }
    
    .event-header h1 {
      font-size: 2.8rem;
      margin-bottom: 20px;
    }
    
    .event-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .event-meta-item {
      display: flex;
      align-items: center;
      color: var(--text-light);
    }
    
    .event-meta-item svg {
      margin-right: 8px;
      color: var(--primary);
    }
    
    .event-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 40px;
    }
    
    .event-description h2 {
      margin-top: 0;
      font-size: 1.8rem;
    }
    
    .event-description p {
      margin-bottom: 25px;
      line-height: 1.7;
    }
    
    .website-button {
      display: inline-flex;
      align-items: center;
      background-color: var(--primary);
      color: white;
      padding: 12px 24px;
      border-radius: 6px;
      font-weight: 500;
      transition: background-color 0.3s;
    }
    
    .website-button svg {
      margin-left: 8px;
    }
    
    .website-button:hover {
      background-color: var(--primary-dark);
    }
    
    .event-sidebar {
      background-color: var(--bg-light);
      border-radius: 8px;
      padding: 25px;
    }
    
    .sidebar-section {
      margin-bottom: 30px;
    }
    
    .sidebar-section:last-child {
      margin-bottom: 0;
    }
    
    .sidebar-section h3 {
      font-size: 1.3rem;
      margin-bottom: 15px;
      color: var(--primary);
    }
    
    .venue-name {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .venue-address {
      color: var(--text-light);
    }
    
    @media (max-width: 768px) {
      .event-content {
        grid-template-columns: 1fr;
      }
      
      .event-header h1 {
        font-size: 2.2rem;
      }
    }
  </style>
</BaseLayout> 